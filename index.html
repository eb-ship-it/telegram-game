<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnyClass — 1 минута для осанки</title>
  <style>
    :root {
      --bg: #0f172a;        /* slate-900 */
      --card: #111827;      /* gray-900 */
      --text: #e5e7eb;      /* gray-200 */
      --muted: #94a3b8;     /* slate-400 */
      --accent: #38bdf8;    /* sky-400 */
      --accent-2: #34d399;  /* emerald-400 */
      --danger: #f87171;    /* red-400 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 50% -30%, #1f2937 0%, var(--bg) 55%);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 16px;
    }
    .app {
      width: 100%;
      max-width: 720px;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 24px;
    }
    h1 { font-size: clamp(22px, 3.5vw, 32px); margin: 0 0 8px; letter-spacing: 0.2px;}
    p.sub { margin: 0 0 16px; color: var(--muted); }
    .card {
      background: var(--card);
      border-radius: calc(var(--radius) - 4px);
      border: 1px solid rgba(255,255,255,.07);
      padding: 16px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
    }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .grow { flex: 1 1 auto; }
    .center { text-align: center; }
    .btn {
      appearance: none;
      border: none;
      border-radius: 14px;
      padding: 12px 18px;
      font-weight: 600;
      color: #0b1220;
      background: linear-gradient(180deg, var(--accent), #0ea5e9);
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(56,189,248,.25);
      transition: transform .06s ease, filter .15s ease;
    }
    .btn:active { transform: translateY(1px) scale(.99); filter: saturate(1.1); }
    .btn.secondary {
      background: linear-gradient(180deg, #c7d2fe, #93c5fd);
      box-shadow: 0 10px 24px rgba(147,197,253,.25);
    }
    .kpi {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin: 12px 0 0;
    }
    .kpi .tile {
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 12px;
      padding: 10px;
      text-align: center;
    }
    .kpi .label { font-size: 12px; color: var(--muted); }
    .kpi .value { font-size: 18px; font-weight: 700; }
    .progress {
      height: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      overflow: hidden;
    }
    .bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent-2), var(--accent));
      transition: width .2s ease;
    }
    .tips {
      margin-top: 12px;
      font-size: 16px;
      color: #d1fae5;
    }
    .dots { display: flex; gap: 8px; justify-content: center; margin-top: 12px; }
    .dot {
      width: 12px; height: 12px; border-radius: 50%;
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    }
    .dot.on { background: linear-gradient(180deg, var(--accent-2), #22c55e); }
    .result {
      font-size: 18px;
      margin-top: 8px;
      color: #e2e8f0;
    }
    .muted { color: var(--muted); }
    .hidden { display: none !important; }
    .hr { height: 1px; background: rgba(255,255,255,.08); margin: 16px 0; }
    .toast {
      position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%);
      background: rgba(15, 23, 42, .85);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 12px; backdrop-filter: blur(6px);
      padding: 10px 14px; font-weight: 600; box-shadow: var(--shadow);
      opacity: 0; transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-4px); }
    @media (max-width: 420px) {
      .kpi { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>1 минута для осанки</h1>
    <p class="sub">Мягкая микропрактика перед тренировкой. Держи плечи раскрытыми и дыхание ровным.</p>

    <!-- START SCREEN -->
    <div id="screen-start" class="card">
      <div class="row">
        <div class="grow">
          <div class="kpi">
            <div class="tile">
              <div class="label">Личный рекорд, сек</div>
              <div class="value" id="bestSec">0</div>
            </div>
            <div class="tile">
              <div class="label">Текущий стрик</div>
              <div class="value" id="streak">0</div>
            </div>
            <div class="tile">
              <div class="label">Цель недели</div>
              <div class="value">7/7</div>
            </div>
          </div>
        </div>
        <div><button class="btn" id="btnStart">Старт</button></div>
      </div>
      <div class="hr"></div>
      <div class="center muted">Каждые 10 сек меняется фокус: макушка ↑, плечи ↓, дыхание, улыбка, челюсть, удержание.</div>
      <div class="dots" id="weeklyDots"></div>
    </div>

    <!-- CHALLENGE SCREEN -->
    <div id="screen-play" class="card hidden">
      <div class="row" style="align-items:center; gap: 8px;">
        <div class="grow">
          <div class="progress"><div id="bar" class="bar"></div></div>
        </div>
        <div style="min-width:72px; text-align:right;">
          <span id="timeLeft" style="font-variant-numeric: tabular-nums; font-weight:700;">60</span><span class="muted">с</span>
        </div>
      </div>
      <div class="tips" id="tip">Вытяни макушку вверх</div>
      <div class="center muted" style="margin-top:6px;">Сохраняй устойчивую позу. Если сбилась — вернись мягко.</div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="screen-result" class="card hidden center">
      <h2 style="margin:6px 0 2px;">Готово!</h2>
      <div class="result" id="resultText">Ты выдержала 60 сек → +1 день к стрику</div>
      <div class="dots" id="weeklyDotsResult" style="margin-top: 14px;"></div>
      <div class="row center" style="justify-content:center; gap:10px; margin-top:14px;">
        <button class="btn secondary" id="btnAgain">Ещё раз</button>
        <button class="btn" id="btnBack">К старту</button>
      </div>
      <div class="muted" style="margin-top:8px;">Совет: закрепи результат короткой тренировкой.</div>
    </div>
  </div>

  <div id="toast" class="toast">+1 день к стрику</div>

  <script>
    // ---- State & storage helpers ----
    const LS = {
      get key() { return 'anyclass_posture'; },
      read() {
        try { return JSON.parse(localStorage.getItem(this.key)) || { bestSec: 0, streak: 0, weekProgress: 0, lastDay: null }; }
        catch(e) { return { bestSec: 0, streak: 0, weekProgress: 0, lastDay: null }; }
      },
      write(data) { localStorage.setItem(this.key, JSON.stringify(data)); }
    };

    const state = {
      duration: 60,            // seconds
      elapsed: 0,
      intervalId: null,
      tipIndex: 0,
      tips: [
        "Вытяни макушку вверх",
        "Опусти плечи",
        "Сохраняй ровное дыхание",
        "Улыбнись, это часть тренировки",
        "Расслабь челюсть",
        "Держи осанку — ты молодец"
      ],
      playing: false
    };

    const $ = (id) => document.getElementById(id);
    const scrStart = $('screen-start');
    const scrPlay = $('screen-play');
    const scrResult = $('screen-result');
    const bestSec = $('bestSec');
    const streak = $('streak');
    const weeklyDots = $('weeklyDots');
    const weeklyDotsResult = $('weeklyDotsResult');
    const bar = $('bar');
    const timeLeft = $('timeLeft');
    const tip = $('tip');
    const toast = $('toast');

    function renderStart() {
      const s = LS.read();
      bestSec.textContent = s.bestSec || 0;
      streak.textContent = s.streak || 0;
      renderDots(weeklyDots, s.weekProgress || 0);
      show(scrStart);
    }

    function renderDots(container, count) {
      container.innerHTML = '';
      for (let i = 0; i < 7; i++) {
        const d = document.createElement('div');
        d.className = 'dot' + (i < count ? ' on' : '');
        container.appendChild(d);
      }
    }

    function hide(...els) { els.forEach(el => el.classList.add('hidden')); }
    function show(...els) { hide(scrStart, scrPlay, scrResult); els.forEach(el => el.classList.remove('hidden')); }

    // ---- Simple "sound" (no external assets) ----
    function beep(type='ok') {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        const hz = type === 'ok' ? 880 : (type === 'tick' ? 440 : 330);
        o.frequency.setValueAtTime(hz, ctx.currentTime);
        g.gain.setValueAtTime(0.001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.05, ctx.currentTime + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.18);
        o.connect(g); g.connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + 0.2);
      } catch(e) { /* ignore */}
    }

    // ---- Timer / Challenge ----
    function startChallenge() {
      state.playing = true;
      state.elapsed = 0;
      state.tipIndex = 0;
      tip.textContent = state.tips[state.tipIndex];
      timeLeft.textContent = state.duration;
      bar.style.width = '0%';
      show(scrPlay);
      const started = Date.now();

      // "tick" every 200ms for smooth bar, but tips every 10 sec
      state.intervalId = setInterval(() => {
        const sec = Math.min(state.duration, Math.floor((Date.now() - started)/1000));
        if (sec !== state.elapsed) {
          state.elapsed = sec;
          const left = state.duration - sec;
          timeLeft.textContent = left;
          bar.style.width = ((sec / state.duration) * 100).toFixed(1) + '%';
          // every 10 seconds change tip (0..5 at 0,10,20,30,40,50)
          if (sec > 0 && sec % 10 === 0 && state.tipIndex < state.tips.length - 1) {
            state.tipIndex++;
            tip.textContent = state.tips[state.tipIndex];
            beep('tick');
          }
          if (left <= 0) {
            clearInterval(state.intervalId);
            finishChallenge(state.duration);
          }
        }
      }, 200);
    }

    function finishChallenge(totalSec) {
      state.playing = false;
      const s = LS.read();
      // streak update: +1 per successful completion, reset if новый день пропущен — упрощённо
      const today = new Date().toDateString();
      const last = s.lastDay;
      if (last !== today) {
        // If last was yesterday -> +1; if same day -> do not double-count; else reset streak
        const y = new Date(Date.now() - 86400000).toDateString();
        if (last === y) {
          s.streak = (s.streak || 0) + 1;
        } else if (last === today) {
          // same day, nothing
        } else {
          // new day after a gap -> start over
          s.streak = 1;
          s.weekProgress = 0; // optional reset weekly
        }
        s.lastDay = today;
        // week progress (cap at 7)
        s.weekProgress = Math.min(7, (s.weekProgress || 0) + 1);
        toastMsg('+1 день к стрику');
      }
      // best seconds
      s.bestSec = Math.max(s.bestSec || 0, totalSec || 60);
      LS.write(s);

      // render result
      $('resultText').textContent = `Ты выдержала ${totalSec} сек → +1 день к стрику`;
      renderDots(weeklyDotsResult, s.weekProgress || 0);
      show(scrResult);
      beep('ok');
    }

    function toastMsg(text) {
      toast.textContent = text;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1500);
    }

    // ---- Events ----
    $('btnStart').addEventListener('click', startChallenge);
    $('btnAgain').addEventListener('click', startChallenge);
    $('btnBack').addEventListener('click', renderStart);

    // init dots on start
    (function init() {
      const s = LS.read();
      renderDots(weeklyDots, s.weekProgress || 0);
      renderStart();
    })();
  </script>
</body>
</html>

